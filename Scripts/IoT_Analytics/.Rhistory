yr_todos_ts_prices$Kitchen_Bill <- round((yr_todos_ts_prices$kitchen/1000)*0.1799,2)
yr_todos_ts_prices$Laundry_Bill <- round((yr_todos_ts_prices$laundry_room/1000)*0.1799,2)
yr_todos_ts_prices$Water_Air_Bill <- round((yr_todos_ts_prices$water_air_systems/1000)*0.1799,2)
yr_todos_ts_prices$Unmeasured_Bill <- round((yr_todos_ts_prices$Monthly_Bill-yr_todos_ts_prices$Kitchen_Bill-yr_todos_ts_prices$Laundry_Bill-yr_todos_ts_prices$Water_Air_Bill),2)
yr_todos_ts_prices <- yr_todos_ts_prices %>% dplyr::select(everything(), ID)
yr_todos_ts_prices <- yr_todos_ts
yr_todos_ts_prices$ID <- floor_date(yr_todos_ts_prices$DateTime, unit = "month")
yr_todos_ts_prices <- yr_todos_ts_prices %>% group_by(year,month, ID) %>% mutate(total_energy = (Global_active_power)*1000/60) %>%
summarise (total_energy = sum(total_energy), kitchen = sum(Sub_metering_1), laundry_room = sum (Sub_metering_2), water_air_systems = sum(Sub_metering_3), Average_Global_intensity = mean(Global_intensity), Average_Voltage = mean(Voltage))
yr_todos_ts_prices$Month_year <- paste(yr_todos_ts_prices$year,"-",yr_todos_ts_prices$month)
yr_todos_ts_prices$Monthly_Bill <- round((yr_todos_ts_prices$total_energy/1000)*0.1799,2)
yr_todos_ts_prices$Kitchen_Bill <- round((yr_todos_ts_prices$kitchen/1000)*0.1799,2)
yr_todos_ts_prices$Laundry_Bill <- round((yr_todos_ts_prices$laundry_room/1000)*0.1799,2)
yr_todos_ts_prices$Water_Air_Bill <- round((yr_todos_ts_prices$water_air_systems/1000)*0.1799,2)
yr_todos_ts_prices$Unmeasured_Bill <- round((yr_todos_ts_prices$Monthly_Bill-yr_todos_ts_prices$Kitchen_Bill-yr_todos_ts_prices$Laundry_Bill-yr_todos_ts_prices$Water_Air_Bill),2)
yr_todos_ts_prices <- yr_todos_ts_prices[,c(1:2,4:15,3)]
write.csv(yr_todos_ts_prices, "power_bi_1.csv")
library(Rtools)
library(DBI)
library(RMySQL)
library(dplyr)
library(tidyr)
library(lubridate)
library(MASS)
library(reshape2)
library(reshape)
library(ggplot2)
library(plotly)
#library(ggfortify)
library(zoo)
library(forecast)
library(padr)
library(ggExtra)
library(imputeTS)
library(prophet)
library(forecastHybrid)
options(scipen=99)
kitchen_energy_month_ts_test <- window(kitchen_energy_month_ts, start = c(2010, 02))
autoplot(kitchen_energy_month_ts) + autolayer(kitchen_energy_month_forec_total$mean, series ="HW")
autoplot(kitchen_energy_month_ts_test) + autolayer(kitchen_energy_month_forec_2$mean, series ="Arima")
autoplot(kitchen_energy_month_ts_test) + autolayer(kitchen_energy_month_hybrid_1_forecast$mean, series ="Hybrid_1")
autoplot(kitchen_energy_month_ts) + autolayer(kitchen_energy_month_hybrid_1_forecast$mean, series ="Hybrid_1")
autoplot(kitchen_energy_month_ts) + autolayer(kitchen_energy_month_forec_total$mean, series ="HW")
autoplot(kitchen_energy_month_ts_test) + autolayer(kitchen_energy_month_forec$mean, series ="HW")
autoplot(kitchen_energy_month_ts) + autolayer(kitchen_energy_month_forec$mean, series ="HW")
autoplot(kitchen_energy_month_ts_test) + autolayer(kitchen_energy_month_forec_2$mean, series ="Arima")
plot(kitchen_energy_month_prophet, kitchen_energy_month_prophet_forecast)
autoplot(kitchen_energy_month_ts_test) + autolayer(kitchen_energy_month_forec_2$mean, series ="Arima")
autoplot(kitchen_energy_month_ts) + autolayer(kitchen_energy_month_forec_2$mean, series ="Arima")
total_energy_month_ts_no_season <- decompose(total_energy_month_ts)
total_energy_month_ts_no_season <- decompose(total_energy_month_ts_strl)
plot(total_energy_month_ts_no_season)
total_energy_month_ts_no_season <- total_energy_month_ts - total_energy_month_ts_no_season$seasonal
total_energy_month_ts_train_no_season <- window(total_energy_month_ts_no_season, end = c(2010, 01))
total_energy_month_ts_test_no_season <- window(total_energy_month_ts_no_season, start = c(2010, 02))
total_energy_month_HW <- HoltWinters(total_energy_month_ts_train_no_season)
total_energy_month_arima1 <- total_energy_month_ts_train_no_season %>% auto.arima()
total_energy_month_forec_2 <- forecast(total_energy_month_arima1, h= 10)
accuracy(total_energy_month_forec_2,total_energy_month_ts_test_no_season)
total_energy_month_hybrid_1 <- hybridModel(total_energy_month_ts_train_no_season, weights="equal")
total_energy_month_hybrid_2 <- hybridModel(total_energy_month_ts_train_no_season, weights="insample")
h <- length(total_energy_month_ts_test)
total_energy_month_hybrid_1_forecast <- forecast(total_energy_month_hybrid_1, h=h)
total_energy_month_hybrid_2_forecast <- forecast(total_energy_month_hybrid_2, h=h)
accuracy(total_energy_month_hybrid_1_forecast,total_energy_month_ts_test_no_season)
accuracy(total_energy_month_hybrid_2_forecast,total_energy_month_ts_test_no_season)
total_energy_month_HW <- HoltWinters(total_energy_month_ts_train_no_season)
kitchen_energy_month <- yr_todos_ts %>% group_by(year,month) %>%
summarise (kitchen = sum(Sub_metering_1))
kitchen_energy_month_ts_no_season <- decompose(kitchen_energy_month_ts_strl)
kitchen_energy_month_ts_no_season <- decompose(kitchen_energy_month_ts)
apply(total_energy_month_ts_strl$time.series,2,var) / var(total_energy_month_ts)
?stl
stl
kitchen_energy_month_ts_no_season <- decompose(kitchen_energy_month_ts)
kitchen_energy_month_ts_no_season <- kitchen_energy_month_ts - kitchen_energy_month_ts_no_season$seasonal
kitchen_energy_month_ts_train_no_season <- window(kitchen_energy_month_ts_no_season, end = c(2010, 01))
kitchen_energy_month_ts_test_no_season <- window(kitchen_energy_month_ts_no_season, start = c(2010, 02))
kitchen_energy_month_HW <- HoltWinters(kitchen_energy_month_ts_train_no_season)
kitchen_energy_month_forec <- forecast(kitchen_energy_month_HW, h= 10)
accuracy(kitchen_energy_month_forec,kitchen_energy_month_ts_test_no_season)
kitchen_energy_month_arima1 <- kitchen_energy_month_ts_train_no_season %>% auto.arima()
kitchen_energy_month_forec_2 <- forecast(kitchen_energy_month_arima1, h= 10)
accuracy(kitchen_energy_month_forec_2,kitchen_energy_month_ts_test_no_season)
kitchen_energy_month_hybrid_1 <- hybridModel(kitchen_energy_month_ts_train_no_season, weights="equal")
kitchen_energy_month_hybrid_2 <- hybridModel(kitchen_energy_month_ts_train_no_season, weights="insample")
h <- length(kitchen_energy_month_ts_test_no_season)
kitchen_energy_month_hybrid_1_forecast <- forecast(kitchen_energy_month_hybrid_1, h=h)
kitchen_energy_month_hybrid_2_forecast <- forecast(kitchen_energy_month_hybrid_2, h=h)
accuracy(kitchen_energy_month_hybrid_1_forecast,kitchen_energy_month_ts_test_no_season)
accuracy(kitchen_energy_month_hybrid_2_forecast,kitchen_energy_month_ts_test_no_season)
autoplot(kitchen_energy_month_ts_test_no_season) + autolayer(kitchen_energy_month_hybrid_1_forecast$mean, series ="Hybrid_1")
autoplot(kitchen_energy_month_ts_test_no_season) + autolayer(kitchen_energy_month_hybrid_2_forecast$mean, series ="hybrid_2")
total_energy_month_HW <- HoltWinters(total_energy_month_ts_train_no_season)
total_energy_month_ts_no_season <- decompose(total_energy_month_ts)
total_energy_month_ts_no_season <- total_energy_month_ts - total_energy_month_ts_no_season$seasonal
total_energy_month_ts_train_no_season <- window(total_energy_month_ts_no_season, end = c(2010, 01))
total_energy_month_ts_test_no_season <- window(total_energy_month_ts_no_season, start = c(2010, 02))
total_energy_month_HW <- HoltWinters(total_energy_month_ts_train_no_season)
plot(kitchen_energy_month_ts_no_season)
laundry_energy_month_ts_no_season <- decompose(laundry_energy_month_ts)
laundry_energy_month_ts_no_season <- laundry_energy_month_ts - laundry_energy_month_ts_no_season$seasonal
laundry_energy_month_ts_train_no_season <- window(laundry_energy_month_ts_no_season, end = c(2010, 01))
laundry_energy_month_ts_test_no_season <- window(laundry_energy_month_ts_no_season, start = c(2010, 02))
kitchen_energy_month_HW <- HoltWinters(kitchen_energy_month_ts_train_no_season)
laundry_energy_month_ts_no_season <- decompose(laundry_energy_month_ts)
laundry_energy_month_ts_no_season <- laundry_energy_month_ts - laundry_energy_month_ts_no_season$seasonal
laundry_energy_month_ts_train_no_season <- window(laundry_energy_month_ts_no_season, end = c(2010, 01))
laundry_energy_month_ts_test_no_season <- window(laundry_energy_month_ts_no_season, start = c(2010, 02))
laundry_energy_month_HW <- HoltWinters(laundry_energy_month_ts_train_no_season)
laundry_energy_month_forec <- forecast(laundry_energy_month_HW, h= 10)
accuracy(laundry_energy_month_forec,laundry_energy_month_ts_test_no_season)
laundry_energy_month_arima1 <- laundry_energy_month_ts_train_no_season %>% auto.arima()
laundry_energy_month_forec_2 <- forecast(laundry_energy_month_arima1, h= 10)
accuracy(laundry_energy_month_forec_2,laundry_energy_month_ts_test_no_season)
laundry_energy_month_hybrid_1 <- hybridModel(laundry_energy_month_ts_train_no_season, weights="equal")
laundry_energy_month_hybrid_2 <- hybridModel(laundry_energy_month_ts_train_no_season, weights="insample")
h <- length(laundry_energy_month_ts_test_no_season)
laundry_energy_month_hybrid_1_forecast <- forecast(laundry_energy_month_hybrid_1, h=h)
laundry_energy_month_hybrid_2_forecast <- forecast(laundry_energy_month_hybrid_2, h=h)
accuracy(laundry_energy_month_hybrid_1_forecast,laundry_energy_month_ts_test_no_season)
accuracy(laundry_energy_month_hybrid_2_forecast,laundry_energy_month_ts_test_no_season)
air_energy_month_ts_no_season <- decompose(air_energy_month_ts)
air_energy_month_ts_no_season <- air_energy_month_ts - air_energy_month_ts_no_season$seasonal
air_energy_month_ts_train_no_season <- window(air_energy_month_ts_no_season, end = c(2010, 01))
air_energy_month_ts_test_no_season <- window(air_energy_month_ts_no_season, start = c(2010, 02))
air_energy_month_HW <- HoltWinters(air_energy_month_ts_train_no_season)
air_energy_month_forec <- forecast(air_energy_month_HW, h= 10) # h = 10 (10 months forecast)
accuracy(air_energy_month_forec,air_energy_month_ts_test_no_season)
air_energy_month_arima1 <- air_energy_month_ts_train_no_season %>% auto.arima()
air_energy_month_forec_2 <- forecast(air_energy_month_arima1, h= 10)
accuracy(air_energy_month_forec_2,air_energy_month_ts_test_no_season)
air_energy_month_hybrid_1 <- hybridModel(air_energy_month_ts_train_no_season, weights="equal")
air_energy_month_hybrid_2 <- hybridModel(air_energy_month_ts_train_no_season, weights="insample")
h <- length(air_energy_month_ts_test_no_season)
air_energy_month_hybrid_1_forecast <- forecast(air_energy_month_hybrid_1, h=h)
air_energy_month_hybrid_2_forecast <- forecast(air_energy_month_hybrid_2, h=h)
accuracy(air_energy_month_hybrid_1_forecast,air_energy_month_ts_test_no_season)
accuracy(air_energy_month_hybrid_2_forecast,air_energy_month_ts_test_no_season)
?HW
?HoltWinters
kitchen_energy_month_HW <- HoltWinters(kitchen_energy_month_ts_train_no_season, seasonal = additive)
kitchen_energy_month_HW <- HoltWinters(kitchen_energy_month_ts_train_no_season, seasonal = "additive")
kitchen_energy_month_forec <- forecast(kitchen_energy_month_HW, h= 10) # h = 10 (10 months forecast)
accuracy(kitchen_energy_month_forec,kitchen_energy_month_ts_test_no_season)
?log
yr_todos_ts_prices_2 <- yr_todos_ts
yr_todos_ts_prices_2$ID <- floor_date(yr_todos_ts_prices$DateTime, unit = "day")
yr_todos_ts_prices_2$ID <- floor_date(yr_todos_ts_prices_2$DateTime, unit = "day")
View(yr_todos_ts_prices_2)
yr_todos_ts_prices_2 <- yr_todos_ts_prices_2 %>% group_by(ID) %>% mutate(total_energy = (Global_active_power)*1000/60) %>%
summarise (total_energy = sum(total_energy), kitchen = sum(Sub_metering_1), laundry_room = sum (Sub_metering_2), water_air_systems = sum(Sub_metering_3), Average_Global_intensity = mean(Global_intensity), Average_Voltage = mean(Voltage))
yr_todos_ts_prices_2$Month_year <- paste(yr_todos_ts_prices_2$year,"-",yr_todos_ts_prices_2$month)
yr_todos_ts_prices_2$Daily_Bill <- round((yr_todos_ts_prices_2$total_energy/1000)*0.1799,2)
yr_todos_ts_prices_2$Kitchen_Bill <- round((yr_todos_ts_prices_2$kitchen/1000)*0.1799,2)
yr_todos_ts_prices_2$Laundry_Bill <- round((yr_todos_ts_prices_2$laundry_room/1000)*0.1799,2)
yr_todos_ts_prices_2$Water_Air_Bill <- round((yr_todos_ts_prices_2$water_air_systems/1000)*0.1799,2)
yr_todos_ts_prices_2$Unmeasured_Bill <- round((yr_todos_ts_prices_2$Daily_Bill-yr_todos_ts_prices_2$Kitchen_Bill-yr_todos_ts_prices_2$Laundry_Bill-yr_todos_ts_prices_2$Water_Air_Bill),2)
yr_todos_ts_prices_2 <- yr_todos_ts_prices_2[,c(1:2,4:15,3)]
yr_todos_ts_prices_2 <- yr_todos_ts
yr_todos_ts_prices_2$ID <- floor_date(yr_todos_ts_prices_2$DateTime, unit = "day")
yr_todos_ts_prices_2 <- yr_todos_ts_prices_2 %>% group_by(ID) %>% mutate(total_energy = (Global_active_power)*1000/60) %>%
summarise (total_energy = sum(total_energy), kitchen = sum(Sub_metering_1), laundry_room = sum (Sub_metering_2), water_air_systems = sum(Sub_metering_3), Average_Global_intensity = mean(Global_intensity), Average_Voltage = mean(Voltage))
yr_todos_ts_prices_2$Daily_Bill <- round((yr_todos_ts_prices_2$total_energy/1000)*0.1799,2)
yr_todos_ts_prices_2$Kitchen_Bill <- round((yr_todos_ts_prices_2$kitchen/1000)*0.1799,2)
yr_todos_ts_prices_2$Laundry_Bill <- round((yr_todos_ts_prices_2$laundry_room/1000)*0.1799,2)
yr_todos_ts_prices_2$Water_Air_Bill <- round((yr_todos_ts_prices_2$water_air_systems/1000)*0.1799,2)
yr_todos_ts_prices_2$Unmeasured_Bill <- round((yr_todos_ts_prices_2$Daily_Bill-yr_todos_ts_prices_2$Kitchen_Bill-yr_todos_ts_prices_2$Laundry_Bill-yr_todos_ts_prices_2$Water_Air_Bill),2)
write.csv(yr_todos_ts_prices_2, "power_bi_2.csv")
yr_todos_ts_prices_2$year <- year(yr_todos_ts_prices_2$ID)
yr_todos_ts_prices_2$month <- month(yr_todos_ts_prices_2$ID, label = TRUE, abbr = FALSE)
yr_todos_ts_prices_2$day <- day(yr_todos_ts_prices_2$ID)
yr_todos_ts_prices_2$Weekday <- weekdays(yr_todos_ts_prices_2$ID)
write.csv(yr_todos_ts_prices_2, "power_bi_2.csv")
library(Rtools)
library(DBI)
library(RMySQL)
library(dplyr)
library(tidyr)
library(lubridate)
library(MASS)
library(reshape2)
library(reshape)
library(ggplot2)
library(plotly)
#library(ggfortify)
library(zoo)
library(forecast)
library(padr)
library(ggExtra)
library(imputeTS)
library(prophet)
library(forecastHybrid)
options(scipen=99)
total_energy_month <- yr_todos_ts %>% group_by(year,month) %>% mutate(total_energy = (Global_active_power)*1000/60) %>%
summarise (total_energy = sum(total_energy))
total_energy_month_ts <- ts(total_energy_month$total_energy, frequency = 12, start = c(2007,01))
total_energy_month_ts_no_season <- decompose(total_energy_month_ts)
total_energy_month_ts_no_season <- total_energy_month_ts - total_energy_month_ts_no_season$seasonal
total_energy_month_ts_train_no_season <- window(total_energy_month_ts_no_season, end = c(2010, 01))
total_energy_month_ts_test_no_season <- window(total_energy_month_ts_no_season, start = c(2010, 02))
total_energy_month_arima1 <- total_energy_month_ts_train_no_season %>% auto.arima()
total_energy_month_forec_2 <- forecast(total_energy_month_arima1, h= 10)
View(total_energy_month_forec_2 )
View(total_energy_month_forec_2$mean)
predicciones_total_energy$predicted_total_energy <- total_energy_month_forec_2$mean
predicted_total_energy <- as.data.frame()
predicted_total_energy <- as.data.frame(c("predicciones"))
predicted_total_energy <- as.data.frame(predicciones)
predicted_total_energy$`c("predicciones")` <- total_energy_month_forec_2$mean
predicted_total_energy <- as.data.frame(total_energy_month_forec_2$mean, row.names(predicciones))
predicted_total_energy <- as.data.frame(total_energy_month_forec_2$mean, row.names("predicciones"))
View(predicted_total_energy)
names(predicted_total_energy) [1] <- "Predicted_Total_Energy"
View(yr_todos_ts_prices_2$month)
View(yr_todos_ts_prices)
predicted_total_energy$ID <- yr_todos_ts_prices[38:47, 15]
predicted_total_energy <- as.data.frame(total_energy_month_forec_2$mean, row.names("predicciones"))
names(predicted_total_energy) [1] <- "Predicted_Total_Energy"
total_energy_month_hybrid_2_total <- hybridModel(total_energy_month_ts_no_season, weights="insample")
h <- length(total_energy_month_ts_test_no_season)
total_energy_month_hybrid_2_total <- hybridModel(total_energy_month_ts_no_season, weights="insample")
total_energy_month_hybrid_2_total_forecast <- forecast(total_energy_month_hybrid_2_total, h=10)
predicted_total_energy <- as.data.frame(total_energy_month_hybrid_2_total_forecast$mean, row.names("predicciones"))
names(predicted_total_energy) [1] <- "Predicted_Total_Energy"
View(total_energy_month_prophet_future)
?floor_date
total_energy_month_prophet_future <- make_future_dataframe(total_energy_month_prophet, periods = 16, freq = "month")
total_energy_month_prophet_future <- make_future_dataframe(total_energy_month_prophet, periods = 20, freq = "month")
predicted_total_energy$ID <- total_energy_month_prophet_future[48:57, 1]
predicted_total_energy$Bill <- round((predicted_total_energy$Predicted_Total_Energy/1000)*0.1799,2)
kitchen_energy_month_ts_no_season <- decompose(kitchen_energy_month_ts)
kitchen_energy_month_ts_no_season <- kitchen_energy_month_ts - kitchen_energy_month_ts_no_season$seasonal
kitchen_energy_total_HW <- HoltWinters(kitchen_energy_month_ts_no_season)
kitchen_energy_month_forec_total <- forecast(kitchen_energy_total_HW, h= 10)
View(kitchen_energy_month_forec_total$mean)
predicted_total_energy$kitchen_energy <- kitchen_energy_month_forec_total$mean
predicted_total_energy$Bill_kitchen_energy <- round((predicted_total_energy$kitchen_energy/1000)*0.1799,2)
laundry_energy_month_ts_no_season <- decompose(laundry_energy_month_ts)
laundry_energy_month_ts_no_season <- laundry_energy_month_ts - laundry_energy_month_ts_no_season$seasonal
laundry_energy_month_hybrid_2_total <- hybridModel(laundry_energy_month_ts_no_season, weights="insample")
laundry_energy_month_hybrid_2_total_forecast <- forecast(laundry_energy_month_hybrid_2_total, h=10)
predicted_total_energy$laundry_energy <- laundry_energy_month_hybrid_2_total_forecast$mean
predicted_total_energy$Bill_laundry_energy <- round((predicted_total_energy$laundry_energy/1000)*0.1799,2)
air_energy_month_ts_no_season <- decompose(air_energy_month_ts)
air_energy_month_ts_no_season <- air_energy_month_ts - air_energy_month_ts_no_season$seasonal
air_energy_month_arima1 <- air_energy_month_ts_no_season %>% auto.arima()
air_energy_month_forec_2 <- forecast(air_energy_month_arima1, h= 10)
predicted_total_energy$air_energy <- air_energy_month_forec_2$mean
predicted_total_energy$Bill_air_energy <- round((predicted_total_energy$air_energy/1000)*0.1799,2)
predicted_total_energy$Unknown_Bill <- round((predicted_total_energy$Bill - predicted_total_energy$Bill_kitchen_energy - predicted_total_energy$Bill_laundry_energy - predicted_total_energy$Bill_air_energy),2)
write.csv(predicted_total_energy, "power_bi_3.csv")
predicted_total_energy <- predicted_total_energy[2:10,]
write.csv(predicted_total_energy, "power_bi_3.csv")
yr_todos_ts <- yr_todos[,-c(2,3,4,12,13,14,15,16,17,18)]
yr_todos_ts <- pad(yr_todos_ts, by="DateTime", break_above=3)
yr_todos_ts_nas_heat <- yr_todos_ts
nas_index <- which(sapply(yr_todos_ts$Sub_metering_1)==T)
nas_index <- which(sapply(yr_todos_ts$Sub_metering_1)=T)
nas_index <- which(is.na(sapply(yr_todos_ts$Sub_metering_1)=T))
nas_index <- which(is.na(sapply(yr_todos_ts$Sub_metering_1)==T))
nas_index <- which(is.na(sapply(yr_todos_ts$Sub_metering_1)==TRUE))
nas_index <- which(is.na(sapply(yr_todos_ts$Sub_metering_1==TRUE)))
nas_index <- which(is.na(sapply(yr_todos_ts$Sub_metering_1)==TRUE))
is.na(sapply(yr_todos_ts$Sub_metering_1)
)
?sapply
nas_index <- which(sapply(is.na(yr_todos_ts$Sub_metering_1)==TRUE))
nas_index <- which(sapply(is.na(yr_todos_ts$Sub_metering_1)=T))
is.na(yr_todos_ts$Sub_metering_1)
nas_index <- which(sapply(is.na(yr_todos_ts$Sub_metering_1=T)))
nas_index <- which(sapply(is.na(yr_todos_ts$Sub_metering_1==T)))
is.na(yr_todos_ts$Sub_metering_1==T
)
sapply(is.na(yr_todos_ts$Sub_metering_1==T)
)
nas_index <- which(is.na(yr_todos_ts$Sub_metering_1==T))
View(nas_index)
nas_index <- which(sapply(is.na(yr_todos_ts$Sub_metering_1))==T)
nas_index <- which(sapply(is.na(yr_todos_ts$Sub_metering_1)==T))
nas_index <- sapply(is.na(yr_todos_ts$Sub_metering_1)==T))
nas_index <- sapply(is.na(yr_todos_ts$Sub_metering_1)==T)
?which
is.na(yr_todos_ts$Sub_metering_1)==T
sapply(is.na(yr_todos_ts$Sub_metering_1)==T)
nas_index <- which(sapply(yr_todos_ts, is.na(yr_todos_ts$Sub_metering_1)==T))
nas_index <- which((is.na(yr_todos_ts$Sub_metering_1)==T))
nas_index <- which(sapply(is.na(yr_todos_ts$Sub_metering_1)==T))
nas_index <- (sapply(is.na(yr_todos_ts$Sub_metering_1)==T))
accuracy(total_energy_month_forec,total_energy_month_ts_test) # Capitulo 12.8 del libro.
nas_index <- yr_todos_ts[is.na(yr_todos_ts$Sub_metering_1==T),]
nas_index <- yr_todos_ts[is.na(yr_todos_ts$Sub_metering_1)==T,]
source("http://blog.revolutionanalytics.com/downloads/calendarHeat.R")
calendarHeat(yr_todos_ts$DateTime,
values= yr_todos_ts$Sub_metering_1,
varname= "Missing values",
color= "w2b")
calendarHeat(yr_todos_ts$DateTime,
values= yr_todos_ts$Sub_metering_1,
varname= "Missing values",
color= "r2b")
yr_todos_ts_prices <- yr_todos_ts
library(Rtools)
library(DBI)
library(RMySQL)
library(dplyr)
library(tidyr)
library(lubridate)
library(MASS)
library(reshape2)
library(reshape)
library(ggplot2)
library(plotly)
#library(ggfortify)
library(zoo)
library(forecast)
library(padr)
library(ggExtra)
library(imputeTS)
library(prophet)
library(forecastHybrid)
options(scipen=99)
yr_todos_ts_prices <- yr_todos_ts
yr_todos_ts_prices$ID <- floor_date(yr_todos_ts_prices$DateTime, unit = "month")
yr_todos_ts_prices <- yr_todos_ts_prices %>% group_by(year,month, ID) %>% mutate(total_energy = (Global_active_power)*1000/60) %>%
summarise (total_energy = sum(total_energy), kitchen = sum(Sub_metering_1), laundry_room = sum (Sub_metering_2), water_air_systems = sum(Sub_metering_3), Average_Global_intensity = mean(Global_intensity), Average_Voltage = mean(Voltage))
yr_todos_ts <- yr_todos[,-c(2,3,4,12,13,14,15,16,17,18)]
yr_todos_ts <- pad(yr_todos_ts, by="DateTime", break_above=3)
yr_todos_ts <- na_interpolation(yr_todos_ts)
yr_todos_ts$year <- year(yr_todos_ts$DateTime)
yr_todos_ts$month <- month(yr_todos_ts$DateTime, label = TRUE, abbr = FALSE)
yr_todos_ts$day <- day(yr_todos_ts$DateTime)
yr_todos_ts$week <- week(yr_todos_ts$DateTime)
yr_todos_ts$minute <- minute(yr_todos_ts$DateTime)
yr_todos_ts$Weekday <- weekdays(yr_todos_ts$DateTime)
yr_todos_ts$hour <- hour(yr_todos_ts$DateTime)
yr_todos_ts_prices <- yr_todos_ts
yr_todos_ts_prices$ID <- floor_date(yr_todos_ts_prices$DateTime, unit = "month")
yr_todos_ts_prices <- yr_todos_ts_prices %>% group_by(year,month, ID) %>% mutate(total_energy = (Global_active_power)*1000/60) %>%
summarise (total_energy = sum(total_energy), kitchen = sum(Sub_metering_1), laundry_room = sum (Sub_metering_2), water_air_systems = sum(Sub_metering_3), Average_Global_intensity = mean(Global_intensity), Average_Voltage = mean(Voltage))
yr_todos_ts_prices$Month_year <- paste(yr_todos_ts_prices$year,"-",yr_todos_ts_prices$month)
yr_todos_ts_prices$Monthly_Bill <- round((yr_todos_ts_prices$total_energy/1000)*0.1799,2)
yr_todos_ts_prices$Kitchen_Bill <- round((yr_todos_ts_prices$kitchen/1000)*0.1799,2)
yr_todos_ts_prices$Laundry_Bill <- round((yr_todos_ts_prices$laundry_room/1000)*0.1799,2)
yr_todos_ts_prices$Water_Air_Bill <- round((yr_todos_ts_prices$water_air_systems/1000)*0.1799,2)
yr_todos_ts_prices$Unmeasured_Bill <- round((yr_todos_ts_prices$Monthly_Bill-yr_todos_ts_prices$Kitchen_Bill-yr_todos_ts_prices$Laundry_Bill-yr_todos_ts_prices$Water_Air_Bill),2)
yr_todos_ts_prices <- yr_todos_ts_prices[,c(1:2,4:15,3)]
total_energy_month <- yr_todos_ts %>% group_by(year,month) %>% mutate(total_energy = (Global_active_power)*1000/60) %>%
summarise (total_energy = sum(total_energy))
total_energy_month_ts <- ts(total_energy_month$total_energy, frequency = 12, start = c(2007,01))
total_energy_month_ts_strl <- total_energy_month_ts %>% stl(s.window = "periodic")
total_energy_month_ts_no_season <- decompose(total_energy_month_ts)
total_energy_month_ts_no_season <- total_energy_month_ts - total_energy_month_ts_no_season$seasonal
total_energy_month_ts_train_no_season <- window(total_energy_month_ts_no_season, end = c(2010, 01))
total_energy_month_ts_test_no_season <- window(total_energy_month_ts_no_season, start = c(2010, 02))
total_energy_month_hybrid_2 <- hybridModel(total_energy_month_ts_train_no_season, weights="insample")
total_energy_month_hybrid_2 <- hybridModel(total_energy_month_ts_train, weights="insample")
h <- length(total_energy_month_ts_test)
total_energy_month <- yr_todos_ts %>% group_by(year,month) %>% mutate(total_energy = (Global_active_power)*1000/60) %>%
summarise (total_energy = sum(total_energy))
total_energy_month_ts <- ts(total_energy_month$total_energy, frequency = 12, start = c(2007,01))
total_energy_month_ts_strl <- total_energy_month_ts %>% stl(s.window = "periodic")
apply(total_energy_month_ts_strl$time.series,2,var) / var(total_energy_month_ts)
total_energy_month_ts_train <- window(total_energy_month_ts, end = c(2010, 01))
total_energy_month_ts_test <- window(total_energy_month_ts, start = c(2010, 02))
total_energy_month_hybrid_1 <- hybridModel(total_energy_month_ts_train, weights="equal")
total_energy_month_hybrid_2 <- hybridModel(total_energy_month_ts_train, weights="insample")
total_energy_month_hybrid_1_forecast <- forecast(total_energy_month_hybrid_1, h=h)
total_energy_month_hybrid_2_forecast <- forecast(total_energy_month_hybrid_2, h=h)
accuracy(total_energy_month_hybrid_1_forecast,total_energy_month_ts_test)
accuracy(total_energy_month_hybrid_2_forecast,total_energy_month_ts_test)
autoplot(total_energy_month_hybrid_2_forecast) + ggtitle("Hybrid 2") + xlab("Year") +
ylab("total Energy Consumption")
autoplot(total_energy_month_hybrid_2_forecast) + ggtitle("Hybrid - Insample mode") + xlab("Year") +
ylab("total Energy Consumption")
autoplot(total_energy_month_ts_test) + autolayer(total_energy_month_hybrid_2_forecast$mean, series ="hybrid_2")
autoplot(total_energy_month_ts) + autolayer(total_energy_month_hybrid_2_forecast$mean, series ="hybrid_2")
View(total_energy_month_hybrid_2_forecast$mean)
total_energy_month_ts_no_season <- decompose(total_energy_month_ts)
total_energy_month_ts_no_season <- total_energy_month_ts - total_energy_month_ts_no_season$seasonal
total_energy_month_ts_train_no_season <- window(total_energy_month_ts_no_season, end = c(2010, 01))
total_energy_month_ts_test_no_season <- window(total_energy_month_ts_no_season, start = c(2010, 02))
total_energy_month_hybrid_2 <- hybridModel(total_energy_month_ts_train_no_season, weights="insample")
total_energy_month_hybrid_2_total <- hybridModel(total_energy_month_ts_no_season, weights="insample")
total_energy_month_hybrid_2_total_forecast <- forecast(total_energy_month_hybrid_2_total, h=h)
total_energy_month <- yr_todos_ts %>% group_by(year,month) %>% mutate(total_energy = (Global_active_power)*1000/60) %>%
summarise (total_energy = sum(total_energy))
total_energy_month_ts <- ts(total_energy_month$total_energy, frequency = 12, start = c(2007,01))
total_energy_month_ts_strl <- total_energy_month_ts %>% stl(s.window = "periodic")
total_energy_month_ts_train <- window(total_energy_month_ts, end = c(2010, 01))
total_energy_month_ts_test <- window(total_energy_month_ts, start = c(2010, 02))
apply(total_energy_month_ts_strl$time.series,2,var) / var(total_energy_month_ts)
total_energy_month_hybrid_1 <- hybridModel(total_energy_month_ts_train, weights="equal")
total_energy_month_hybrid_2 <- hybridModel(total_energy_month_ts_train, weights="insample")
total_energy_month_hybrid_2_total <- hybridModel(total_energy_month_ts, weights="insample")
h <- length(total_energy_month_ts_test)
total_energy_month_hybrid_1_forecast <- forecast(total_energy_month_hybrid_1, h=h)
total_energy_month_hybrid_2_total_forecast <- forecast(total_energy_month_hybrid_2_total, h=h)
kitchen_energy_month <- yr_todos_ts %>% group_by(year,month) %>%
summarise (kitchen = sum(Sub_metering_1))
kitchen_energy_month_ts <- ts(kitchen_energy_month$kitchen, frequency = 12, start = c(2007,01))
kitchen_energy_month_ts_strl <- kitchen_energy_month_ts %>% stl(s.window = "periodic")
kitchen_energy_month_ts_train <- window(kitchen_energy_month_ts, end = c(2010, 01))
kitchen_energy_month_ts_test <- window(kitchen_energy_month_ts, start = c(2010, 02))
kitchen_energy_month_HW <- HoltWinters(kitchen_energy_month_ts_train)
kitchen_energy_month_forec <- forecast(kitchen_energy_month_HW, h= 10) # h = 10 (10 months forecast)
kitchen_energy_total_HW <- HoltWinters(kitchen_energy_month_ts)
kitchen_energy_month_forec_total <- forecast(kitchen_energy_total_HW, h= 10)
laundry_energy_month <- yr_todos_ts %>% group_by(year,month) %>%
summarise (laundry_room = sum(Sub_metering_2))
laundry_energy_month_ts <- ts(laundry_energy_month$laundry_room, frequency = 12, start = c(2007,01))
laundry_energy_month_ts_strl <- laundry_energy_month_ts %>% stl(s.window = "periodic")
laundry_energy_month_ts_train <- window(laundry_energy_month_ts, end = c(2010, 01))
laundry_energy_month_ts_test <- window(laundry_energy_month_ts, start = c(2010, 02))
laundry_energy_month_hybrid_2_total <- hybridModel(laundry_energy_month_ts, weights="insample")
h <- length(laundry_energy_month_ts_test)
laundry_energy_month_hybrid_2_forecast <- forecast(laundry_energy_month_hybrid_2, h=h)
laundry_energy_month_hybrid_2_total_forecast <- forecast(laundry_energy_month_hybrid_2_total, h=h)
air_energy_month <- yr_todos_ts %>% group_by(year,month) %>%
summarise (water_air_systems = sum(Sub_metering_3))
air_energy_month_ts <- ts(air_energy_month$water_air_systems, frequency = 12, start = c(2007,01))
air_energy_month_ts_strl <- air_energy_month_ts %>% stl(s.window = "periodic")
air_energy_month_ts_train <- window(air_energy_month_ts, end = c(2010, 01))
air_energy_month_ts_test <- window(air_energy_month_ts, start = c(2010, 02))
air_energy_month_arima1 <- air_energy_month_ts_train %>% auto.arima()
air_energy_month_forec_2 <- forecast(air_energy_month_arima1, h= 10)
air_energy_month_arima_total <- air_energy_month_ts %>% auto.arima()
air_energy_month_forec_2_total <- forecast(air_energy_month_arima_total, h= 10)
predicted_total_energy <- as.data.frame(total_energy_month_hybrid_2_total_forecast$mean, row.names("predicciones"))
names(predicted_total_energy) [1] <- "Predicted_Total_Energy"
predicted_total_energy$ID <- total_energy_month_prophet_future[48:57, 1]
predicted_total_energy$Bill <- round((predicted_total_energy$Predicted_Total_Energy/1000)*0.1799,2)
predicted_total_energy$kitchen_energy <- kitchen_energy_month_forec_total$mean
predicted_total_energy$Bill_kitchen_energy <- round((predicted_total_energy$kitchen_energy/1000)*0.1799,2)
predicted_total_energy$laundry_energy <- laundry_energy_month_hybrid_2_total_forecast$mean
predicted_total_energy$Bill_laundry_energy <- round((predicted_total_energy$laundry_energy/1000)*0.1799,2)
predicted_total_energy$air_energy <- air_energy_month_forec_2$mean
predicted_total_energy$Bill_air_energy <- round((predicted_total_energy$air_energy/1000)*0.1799,2)
predicted_total_energy$Unknown_Bill <- round((predicted_total_energy$Bill - predicted_total_energy$Bill_kitchen_energy - predicted_total_energy$Bill_laundry_energy - predicted_total_energy$Bill_air_energy),2)
predicted_total_energy <- as.data.frame(total_energy_month_hybrid_2_total_forecast$mean, row.names("predicciones"))
names(predicted_total_energy) [1] <- "Predicted_Total_Energy"
predicted_total_energy$ID <- total_energy_month_prophet_future[48:57, 1]
predicted_total_energy$Bill <- round((predicted_total_energy$Predicted_Total_Energy/1000)*0.1799,2)
predicted_total_energy$kitchen_energy <- kitchen_energy_month_forec_total$mean
predicted_total_energy$Bill_kitchen_energy <- round((predicted_total_energy$kitchen_energy/1000)*0.1799,2)
predicted_total_energy$laundry_energy <- laundry_energy_month_hybrid_2_total_forecast$mean
predicted_total_energy$Bill_laundry_energy <- round((predicted_total_energy$laundry_energy/1000)*0.1799,2)
predicted_total_energy$air_energy <- air_energy_month_forec_2$mean
predicted_total_energy$Bill_air_energy <- round((predicted_total_energy$air_energy/1000)*0.1799,2)
predicted_total_energy$Unknown_Bill <- round((predicted_total_energy$Bill - predicted_total_energy$Bill_kitchen_energy - predicted_total_energy$Bill_laundry_energy - predicted_total_energy$Bill_air_energy),2)
str(predicted_total_energy)
predicted_total_energy <- as.data.frame(total_energy_month_hybrid_2_total_forecast$mean, row.names("predicciones"))
str(predicted_total_energy)
names(predicted_total_energy) [1] <- "Predicted_Total_Energy"
predicted_total_energy$ID <- total_energy_month_prophet_future[48:57, 1]
predicted_total_energy$Bill <- round((predicted_total_energy$Predicted_Total_Energy/1000)*0.1799,2)
predicted_total_energy$kitchen_energy <- kitchen_energy_month_forec_total$mean
predicted_total_energy$Bill_kitchen_energy <- round((predicted_total_energy$kitchen_energy/1000)*0.1799,2)
predicted_total_energy$laundry_energy <- laundry_energy_month_hybrid_2_total_forecast$mean
predicted_total_energy$Bill_laundry_energy <- round((predicted_total_energy$laundry_energy/1000)*0.1799,2)
predicted_total_energy$air_energy <- air_energy_month_forec_2$mean
predicted_total_energy$Bill_air_energy <- round((predicted_total_energy$air_energy/1000)*0.1799,2)
str(predicted_total_energy)
predicted_total_energy <- as.numeric(predicted_total_energy[,-C(2)])
predicted_total_energy <- as.numeric(predicted_total_energy[,-c(2)])
predicted_total_energy <- as.numeric(predicted_total_energy[,c(1,3:9)])
predicted_total_energy$Unknown_Bill <- as.number(round((predicted_total_energy$Bill - predicted_total_energy$Bill_kitchen_energy - predicted_total_energy$Bill_laundry_energy - predicted_total_energy$Bill_air_energy),2))
predicted_total_energy$Unknown_Bill <- as.numeric(round((predicted_total_energy$Bill - predicted_total_energy$Bill_kitchen_energy - predicted_total_energy$Bill_laundry_energy - predicted_total_energy$Bill_air_energy),2))
predicted_total_energy <- as.numeric(predicted_total_energy$Predicted_Total_Energy)
str(predicted_total_energy)
predicted_total_energy <- as.data.frame(total_energy_month_hybrid_2_total_forecast$mean, row.names("predicciones"))
names(predicted_total_energy) [1] <- "Predicted_Total_Energy"
predicted_total_energy$ID <- total_energy_month_prophet_future[48:57, 1]
predicted_total_energy$Bill <- round((predicted_total_energy$Predicted_Total_Energy/1000)*0.1799,2)
predicted_total_energy$kitchen_energy <- kitchen_energy_month_forec_total$mean
predicted_total_energy$Bill_kitchen_energy <- round((predicted_total_energy$kitchen_energy/1000)*0.1799,2)
predicted_total_energy$laundry_energy <- laundry_energy_month_hybrid_2_total_forecast$mean
predicted_total_energy$Bill_laundry_energy <- round((predicted_total_energy$laundry_energy/1000)*0.1799,2)
predicted_total_energy$air_energy <- air_energy_month_forec_2$mean
predicted_total_energy$Bill_air_energy <- round((predicted_total_energy$air_energy/1000)*0.1799,2)
predicted_total_energy <- as.numeric(predicted_total_energy$Predicted_Total_Energy)
predicted_total_energy <- as.data.frame(total_energy_month_hybrid_2_total_forecast$mean, row.names("predicciones"))
names(predicted_total_energy) [1] <- "Predicted_Total_Energy"
predicted_total_energy$ID <- total_energy_month_prophet_future[48:57, 1]
predicted_total_energy$Bill <- round((predicted_total_energy$Predicted_Total_Energy/1000)*0.1799,2)
predicted_total_energy$kitchen_energy <- kitchen_energy_month_forec_total$mean
predicted_total_energy$Bill_kitchen_energy <- round((predicted_total_energy$kitchen_energy/1000)*0.1799,2)
predicted_total_energy$laundry_energy <- laundry_energy_month_hybrid_2_total_forecast$mean
predicted_total_energy$Bill_laundry_energy <- round((predicted_total_energy$laundry_energy/1000)*0.1799,2)
predicted_total_energy$air_energy <- air_energy_month_forec_2$mean
predicted_total_energy$Bill_air_energy <- round((predicted_total_energy$air_energy/1000)*0.1799,2)
str(predicted_total_energy)
predicted_total_energy$Unknown_Bill <- round((predicted_total_energy$Bill - predicted_total_energy$Bill_kitchen_energy - predicted_total_energy$Bill_laundry_energy - predicted_total_energy$Bill_air_energy),2)
predicted_total_energy$laundry_energy
as.numeric(predicted_total_energy$laundry_energy)
predicted_total_energy$Unknown_Bill <- round((as.numeric(predicted_total_energy$Bill) - as.numeric(predicted_total_energy$Bill_kitchen_energy) - as.numeric(predicted_total_energy$Bill_laundry_energy) - as.numeric(predicted_total_energy$Bill_air_energy),2))
predicted_total_energy$Unknown_Bill <- round(as.numeric(predicted_total_energy$Bill) - as.numeric(predicted_total_energy$Bill_kitchen_energy) - as.numeric(predicted_total_energy$Bill_laundry_energy) - as.numeric(predicted_total_energy$Bill_air_energy),2)
predicted_total_energy <- predicted_total_energy[2:10,]
write.csv(predicted_total_energy, "power_bi_3.csv")
total_energy_month_ts_no_season <- decompose(total_energy_month_ts)
total_energy_month_ts_no_season <- total_energy_month_ts - total_energy_month_ts_no_season$seasonal
total_energy_month_ts_train_no_season <- window(total_energy_month_ts_no_season, end = c(2010, 01))
total_energy_month_ts_test_no_season <- window(total_energy_month_ts_no_season, start = c(2010, 02))
total_energy_month_hybrid_2_total <- hybridModel(total_energy_month_ts_no_season, weights="insample")
total_energy_month_hybrid_2_forecast <- forecast(total_energy_month_hybrid_2, h=h)
accuracy(total_energy_month_hybrid_2_forecast,total_energy_month_ts_test)
autoplot(total_energy_month_hybrid_2_forecast) + ggtitle("Hybrid - Insample mode") + xlab("Year") +
ylab("total Energy Consumption")
autoplot(total_energy_month_ts_test) + autolayer(total_energy_month_hybrid_2_forecast$mean, series ="hybrid_2")
autoplot(total_energy_month_ts) + autolayer(total_energy_month_hybrid_2_forecast$mean, series ="hybrid_2")
?na_interpolation
?hybridModel
